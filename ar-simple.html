<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Indian Heritage AR - Simple</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.0/aframe/build/aframe-ar.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script>
    <style>
        .model-btn {
            position: fixed;
            bottom: 20px;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 20px;
            margin: 0 5px;
            z-index: 100;
        }
        #model-selector {
            position: fixed;
            bottom: 0;
            width: 100%;
            text-align: center;
            padding: 10px 0;
            background: rgba(0,0,0,0.5);
            z-index: 99;
        }
        #info {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            text-align: center;
            z-index: 100;
        }
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
    </style>
</head>
<body style='margin: 0; overflow: hidden;'>
    <div id="info">Move your phone to detect surfaces, then tap to place the model</div>
    <div id="loading">
        <h2>Loading AR Experience...</h2>
        <p>Please wait while we set up the AR environment</p>
    </div>

    <a-scene 
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; antialias: true;"
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false; sourceWidth: 1280; sourceHeight: 720; displayWidth: 1280; displayHeight: 720;"
        gesture-detector
        loading-screen="dotsColor: #0080e5; backgroundColor: #000000">
        
        <!-- Use the simpler marker-based AR for better compatibility -->
        <a-marker preset="hiro">
            <a-entity id="model-container"></a-entity>
        </a-marker>
        
        <a-entity camera></a-entity>
    </a-scene>

    <div id="model-selector">
        <button class="model-btn" onclick="loadModel('taj_mahal')">Taj Mahal</button>
        <button class="model-btn" onclick="loadModel('hampi')">Hampi</button>
        <button class="model-btn" onclick="loadModel('khajuraho')">Khajuraho</button>
        <button class="model-btn" onclick="loadModel('konark')">Konark</button>
    </div>

    <script>
        // Model data with proper scaling and rotation
        const models = {
            'taj_mahal': {
                path: 'models/taj_mahal/scene.glb',
                scale: '0.5 0.5 0.5',
                position: '0 0 0',
                rotation: '-90 0 0',
                animation: 'property: rotation; to: 0 360 0; loop: true; dur: 20000',
                offset: '0 0 0'
            },
            'hampi': {
                path: 'models/hampi/scene.glb',
                scale: '0.5 0.5 0.5',
                position: '0 0 0',
                rotation: '-90 0 0',
                animation: 'property: rotation; to: 0 360 0; loop: true; dur: 20000',
                offset: '0 0 0'
            },
            'khajuraho': {
                path: 'models/khajuraho/scene.glb',
                scale: '0.5 0.5 0.5',
                position: '0 0 0',
                rotation: '-90 0 0',
                animation: 'property: rotation; to: 0 360 0; loop: true; dur: 20000',
                offset: '0 0 0'
            },
            'konark': {
                path: 'models/konark/scene.glb',
                scale: '0.5 0.5 0.5',
                position: '0 0 0',
                rotation: '-90 0 0',
                animation: 'property: rotation; to: 0 360 0; loop: true; dur: 20000',
                offset: '0 0 0'
            }
        };

        // Load a model with better error handling and model positioning
        function loadModel(modelId) {
            console.log('Loading model:', modelId);
            const container = document.querySelector('#model-container');
            const modelData = models[modelId];
            
            // Clear existing model
            container.innerHTML = '';
            
            // Create a wrapper for better positioning
            const wrapper = document.createElement('a-entity');
            wrapper.setAttribute('position', modelData.offset);
            
            // Create the model
            const model = document.createElement('a-entity');
            
            // Add model with event listeners for loading
            model.setAttribute('gltf-model', `url(${modelData.path})`);
            model.setAttribute('scale', modelData.scale);
            model.setAttribute('position', modelData.position);
            model.setAttribute('rotation', modelData.rotation);
            model.setAttribute('animation', modelData.animation);
            
            // Add model to wrapper
            wrapper.appendChild(model);
            
            // Add wrapper to container
            container.appendChild(wrapper);
            
            // Handle model loaded event
            model.addEventListener('model-loaded', function() {
                console.log('Model loaded successfully');
                // Adjust model if needed
                const modelEl = model.getObject3D('mesh');
                if (modelEl) {
                    modelEl.traverse(function(node) {
                        if (node.isMesh) {
                            node.castShadow = true;
                            node.receiveShadow = true;
                        }
                    });
                }
            });
            
            // Show info
            const info = document.getElementById('info');
            info.textContent = `Loaded ${modelId}. Show the Hiro marker to your camera.`;
            info.style.display = 'block';
            setTimeout(() => { info.style.display = 'none'; }, 3000);
            
            // Log for debugging
            console.log('Model loading initiated, waiting for marker...');
            
            // Add error handling
            model.addEventListener('error', function(err) {
                console.error('Error loading model:', err);
                info.textContent = `Error loading ${modelId}. Check console for details.`;
                info.style.display = 'block';
            });
        }

        // Hide loading screen when scene is loaded
        document.querySelector('a-scene').addEventListener('loaded', function() {
            console.log('Scene loaded');
            document.getElementById('loading').style.display = 'none';
            
            // Load first model by default
            loadModel('taj_mahal');
        });

        // Handle errors
        window.addEventListener('arjs-video-loaded', function() {
            console.log('AR.js video loaded');
        });

        window.addEventListener('arjs-nft-loaded', function() {
            console.log('AR.js NFT loaded');
        });

        // Debug: Log any errors
        window.addEventListener('error', function(error) {
            console.error('Error:', error);
        });
    </script>
</body>
</html>
